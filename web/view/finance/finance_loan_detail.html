<!-- 主菜单：财务管理 -> 金融贷出（详情） 画面 -->

<!-- 返回前画面 按钮 -->
<div class="row valign-wrapper">
    <a class="btn-floating btn waves-effect cyan lighten-1 waves-light" ng-click="return()">
        <i class="mdi mdi-arrow-left-bold"></i>
    </a>
    <h5 class="col s12 cyan-text lighten-1  center-align">贷出详情</h5>
</div>
<div class="row">
    <div class="divider  cyan lighten-2" style="height:2px"></div>
</div>

<!--按键切换以及详情  支付信息   关联仓储订单-->
<div class="row no-marBottom" ul-tabs>
    <div class="col s12 p0" style="width: 96%; margin:0 2%">

        <!--按键切换  支付信息   关联仓储订单-->
        <ul class="tabWrap grey lighten-4 ">
            <li class="tab col s3 lookLoanFinfoDiv vc-center"  ng-click="lookLoanInfo()">贷出信息</li>
            <li class="tab col s3 lookMortgageCar vc-center"  ng-click="lookMortgageCar()">抵押车辆</li>
            <li class="tab col s3 lookBuyingCars vc-center"  ng-click="lookBuyingCars()">购买车辆</li>
            <li class="tab col s3 lookPaymentHistory vc-center"  ng-click="lookPaymentHistory()">还款记录</li>
        </ul>
    </div>

    <!-- TAB 1 贷出信息 -->
    <div id="lookLoanFinfoDiv" class="col s12 tab_box" style="width: 90%; margin:0 5% ">
        <!-- TODO 未完结状态下 -->
        <div class="modal-content">
            <div class="row col s12 bold" style="color:#4e84cb ;margin-top: 40px;">
                <div class="col s6 fz18" >贷出编号: {{loanInfo.id}}</div>
                <div class="col s6 right-align">{{loanStatus[loanInfo.loanStatus-1].name}}</div>
                <!--<div class="col s6 right-align" ng-class="{'red-text':storagePaymentArray.payment_status==1}">{{loanStatus[storagePaymentArray.payment_status-1].name}}</div>-->
            </div>

            <!--实分割线-->
            <div class="row col s12" style="height:2px;border-bottom: 1px solid #ccc;width:96%;margin-left: 2%"></div>

            <div class="row col s12 cyan-text">
                <div class="col s6" >委托方: {{loanInfo.entrustName}}</div>
                <div class="col s6 grey-text right-align">贷出时间: {{loanInfo.createdOn |date:'yyyy-MM-dd hh:mm'}}</div>
            </div>

            <!-- 抵押金额，贷款金额 -->
            <div class="row col s12" style="margin-top: 40px;">
                <!-- 抵押金额 -->
                <div class="input-field col s6">
                    <input type="text" id="mortgageText" maxlength="10" valid-money ng-model="loanInfo.mortgageValuation" class="red-text">
                    <label for="mortgageText" id="mortgageLabel"> 抵押金额(美元)</label>
                </div>

                <!-- 贷款金额(美元) -->
                <div class="input-field col s6">
                    <input type="text" id="loanMoneyText" maxlength="10" valid-money ng-model="loanInfo.loanMoney" class="red-text">
                    <label for="loanMoneyText" id="loanMoneyLabel"> 贷出金额(美元)</label>
                </div>
            </div>

            <!-- 备注 -->
            <div class="row col s12">
                <div class="col s12 input-field">
                    <input type="text" name="addRemark" id="addRemark" ng-model="loanInfo.remark">
                    <label for="addRemark">备注</label>
                </div>
            </div>
        </div>
        <div class="row col s12 right-align" style="margin-top: 50px">
            <div class="col s10"></div>
            <div class="col s2 right-align">
                <a ng-click="updatePaymentInfo()" style="width: 100%" class="waves-light waves-effect cyan lighten-2 btn">修改</a>
            </div>
        </div>
    </div>

    <!-- TAB 2 抵押车辆 -->
    <div id="lookMortgageCar" class="col s12 tab_box" style="width: 100%; margin:30px 0">

        <!-- 第一行 委托方，贷出金额，抵押总金额 信息 -->
        <div class="col s6 vc-center fz17 bold cyan-text" style="height: 50px;">
            <!-- 委托方 个人 -->
            <div class="col s12" ng-if="loanInfo.entrustType==mortgageStatus[0].id">
                <i class="mdi mdi-account fz40"></i>
                <span style="margin-left:20px;margin-bottom: 25px;">{{loanInfo.entrustName}}</span>
            </div>
            <!-- 委托方 企业 -->
            <div class="col s12" ng-if="loanInfo.entrustType==mortgageStatus[1].id">
                <i class="mdi mdi-domain fz40"></i>
                <span style="margin-left:20px;margin-bottom: 25px;">{{loanInfo.entrustName}}</span>
            </div>
        </div>
        <div class="col s6 vc-center fz17 bold cyan-text" style="height: 50px;">
            <div class="col s6 left-align">
                贷出金额(美元):<span class="red-text fz20">{{loanInfo.loanMoney | number}}</span>
            </div>
            <div class="col s6 right-align">
                抵押总金额(美元):<span class="red-text fz20">{{totalMortgageMoney | number}}</span>
            </div>
        </div>

        <!-- 左侧 无数据 委托方拥有未抵押车辆 -->
        <div class="col s6" ng-if="entrustCarList.length==0">
            <div class="card" style="border: 2px solid #ccc">
                <div class="card-content bold cyan-text fz18 left-align grey lighten-4" style="border-bottom: 2px solid #ccc">
                    委托方拥有未抵押车辆
                </div>
                <div class="card-content">
                    <div style="height:200px;line-height: 200px;text-align: center">
                        <i class="mdi  mdi-alert-circle-outline red-text fz30"></i>
                        <span class="bold grey-text fz22">请先去仓储板块登记抵押车辆入库信息</span>
                    </div>
                </div>
            </div>
        </div>
        <!-- 左侧 有数据 委托方拥有未抵押车辆 有可抵押车辆 -->
        <div class="col s6" ng-if="entrustCarList.length!==0">
            <div class="card" style="border: 2px solid #ccc;height:auto">
                <div class="card-content bold cyan-text fz18 left-align grey lighten-4" style="border-bottom: 2px solid #ccc">
                    委托方拥有未抵押车辆
                </div>
                <div class="card-content">
                    <table class="bordered centered" style="width: 100%;">
                        <thead>
                        <tr class="grey-text text-darken-2">
                            <th data-field="">VIN码</th>
                            <th data-field="">车型</th>
                            <th data-field="">生产日期</th>
                            <th data-field="">入库时间</th>
                            <th data-field="">车辆估值(美元)</th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="el in entrustCarList" class="grey-text text-darken-1" style="height:30px">
                            <td ng-bind="el.vin"></td>
                            <td>{{el.make_name}}/{{el.model_name}}</td>
                            <td>{{el.pro_date |date:'yyyy-MM-dd'}}</td>
                            <td>{{el.enter_time |date:'yyyy-MM-dd hh:mm'}}</td>
                            <td class="red-text">{{el.valuation|number}}</td>

                            <!-- 显示画面按钮 -->
                            <td class="operation" ng-switch="el.mortgage_status">
                                <a ng-switch-when="1" ng-click="addMortgageCarRel(el.id)" class="col s2 left" style="cursor: pointer">
                                    <i class="mdi mdi-plus-circle look_icon cyan-text lighten-1 fz25"></i>
                                </a>
                                <a ng-switch-default class="col s2 left" style="cursor: default">
                                    <i class="mdi mdi-plus-circle look_icon grey-text lighten-1 fz25" style="cursor: default"></i>
                                </a>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 右侧 无数据 本次贷款抵押车辆 -->
        <div class="col s6"  ng-if="mortgageCarRelList.length==0">
            <div class="card" style="border: 2px solid #ccc">
                <div class="card-content bold cyan-text fz18 left-align grey lighten-4" style="border-bottom: 2px solid #ccc">
                    本次贷款抵押车辆
                </div>
                <div class="card-content">
                    <div style="height:200px;line-height: 200px;text-align: center">
                        <i class="mdi  mdi-alert-circle-outline red-text fz30"></i>
                        <span class="bold grey-text fz22">请从左边车辆中选择</span>
                    </div>
                </div>
            </div>
        </div>
        <!-- 右侧 有数据 本次贷款抵押车辆 -->
        <div class="col s6"  ng-if="mortgageCarRelList.length!==0">
            <div class="card" style="border: 2px solid #ccc">
                <div class="card-content bold cyan-text fz18 left-align grey lighten-4" style="border-bottom: 2px solid #ccc">
                    本次贷款抵押车辆
                </div>
                <div class="card-content">
                    <table class="bordered centered" style="width: 100%;">
                        <thead>
                        <tr class="grey-text text-darken-2">
                            <th data-field="">VIN码</th>
                            <th data-field="">车型</th>
                            <th data-field="">生产日期</th>
                            <th data-field="">入库时间</th>
                            <th data-field="">车辆估值(美元)</th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="el in mortgageCarRelList" class="grey-text text-darken-1" style="height:30px">
                            <td ng-bind="el.vin"></td>
                            <td>{{el.make_name}}/{{el.model_name}}</td>
                            <td>{{el.pro_date |date:'yyyy-MM-dd'}}</td>
                            <td>{{el.enter_time |date:'yyyy-MM-dd hh:mm'}}</td>
                            <td class="red-text">{{el.valuation|number}}</td>

                            <!-- 显示画面按钮 -->
                            <td class="operation">
                                <a  ng-click="deleteMortgageCarRel(el.car_id)" class="col s2 left" style="cursor: pointer">
                                    <i class="mdi mdi-do-not-disturb look_icon red-text lighten-1 fz25"></i>
                                </a>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- TAB 3 购买车辆 -->
    <div id="lookBuyingCars" class="col s12 tab_box" style="width: 100%; margin:30px 0">

        <div class="row col s12 bold" style="color:#4e84cb ;margin-top: 0px;">
            <div class="col s6" >购买车辆: {{buyingCar.carLength | number}}</div>
            <div class="col s6 right-align">车价总额(美元): <span class="red-text">{{buyingCar.totalMoney | number}}</span></div>
        </div>

        <!--虚分割线-->
        <div  class="row col s12" style="height:1px;border-bottom: 1px dotted #ccc;width:96%;margin-left: 2%"></div>

        <!-- VIN -->
        <div class="col s12">
            <div class="input-field col s12">
                <input type="text" placeholder="模糊查询至少6位，新增车辆完整17位" id="autocomplete-input" ng-change="changeVin()" class="autocomplete" ng-model="buyingCar.vin" >
                <a ng-if="addCarInfoFlg" ng-click="addCarInfo()" class="dataIcon btn-floating cyan" style="width:20px;height: 20px;">
                    <i class="mdi mdi-plus" style="position: absolute;right:0px;bottom:0px;font-size:15px;line-height: 20px;"></i>
                </a>
                <a ng-if="!addCarInfoFlg" class="dataIcon btn-floating grey" style="width:20px;height: 20px;cursor: default">
                    <i class="mdi mdi-plus" style="position: absolute;right:0px;bottom:0px;font-size:15px;line-height: 20px;"></i>
                </a>

                <label for="autocomplete-input" class="active" style="padding-left: 2px;"> 购买车辆VIN码</label>
            </div>
        </div>

        <!-- 新增车辆信息(自定义) -->
        <div ng-show="showCustomCarDiv" class="col s12">
            <div class="row blue-grey lighten-5" style="width: 98%; border:1px solid #bdbdbd;border-top:0;">
                <!-- header -->
                <div class="col s12 lighten-1 cyan-text fz14 left-align vc-center" style="height:46px;">
                    <div class="col s12 left-align">
                        新增车辆信息
                    </div>
                </div>

                <!-- body -->
                <div class="col s12 lighten-1 white grey-text vc-center">
                    <!-- VIN码 -->
                    <div class="input-field col s3 left-align fz15">VIN码:{{customCarInfo.vin}}
                    </div>
                    <!-- 制造商 -->
                    <div class="input-field col s3 left-align">
                        <select material-select watch ng-model="customCarInfo.maker" ng-change="changeMakerId(customCarInfo.maker.id)">
                            <option value="" disabled>制造商</option>
                            <option ng-repeat="el in carMakerList" ng-value="el">{{el.make_name}}</option>
                        </select>
                    </div>
                    <!-- 型号 -->
                    <div class="input-field col s3 left-align">
                        <select material-select watch ng-model="customCarInfo.model">
                            <option value="" disabled>型号</option>
                            <option ng-repeat="el in carModelList" ng-value="el">{{el.model_name}}</option>
                        </select>
                    </div>
                    <!-- 颜色 -->
                    <div class="input-field col s3 left-align">
                        <select material-select watch ng-model="customCarInfo.colour">
                            <option value="" disabled>颜色</option>
                            <option ng-repeat="el in configColor" ng-value="el.colorId">{{el.colorName}}</option>
                        </select>
                    </div>
                </div>

                <div class="col s12 lighten-1 white grey-text vc-center">
                    <!-- 生产日期 -->
                    <div class="input-field col s3 left-align">
                        <input id="proDateText" type="text" ng-model="customCarInfo.proDate" class="datepicker" date><i
                            class="mdi dataIcon mdi-table-large"></i>
                        <label for="proDateText">生产日期</label>
                    </div>
                    <!-- 发动机号 -->
                    <div class="input-field col s3 left-align">
                        <input type="text" id="engineNumText" ng-model="customCarInfo.engineNum">
                        <label for="engineNumText">发动机号</label>
                    </div>
                    <!-- 是否MSO -->
                    <div class="input-field col s3">
                        <select material-select watch id="msoSelect" ng-model="customCarInfo.msoStatus" >
                            <option value="" disabled>是否MSO</option>
                            <option ng-repeat="el in msoFlags" ng-value="el.id">{{el.name}}</option>
                        </select>
                    </div>
                    <!-- 车辆估值 -->
                    <div class="input-field col s3 left-align">
                        <input type="text" id="valuationText" maxlength="8" valid-money ng-model="customCarInfo.valuation">
                        <label for="valuationText"><span class="red-text">*</span>车辆估值(美元)</label>
                    </div>
                </div>
                <!-- 车辆备注 -->
                <div class="col s12 lighten-1 white grey-text vc-center">
                    <div class="input-field col s12 left-align">
                        <input type="text" id="remarkText" maxlength="8" valid-money ng-model="customCarInfo.remark">
                        <label for="remarkText">车辆备注</label>
                    </div>
                </div>
                <!-- 取消/确认 按钮 -->
                <div class="col s12 right-align white" style="padding-top: 15px;padding-right: 25px;padding-bottom: 15px;">
                    <a class="btn-floating waves-effect waves-light grey" style="width:30px;height: 30px;" ng-click="closeCustomCarDiv()">
                        <i class="mdi mdi-close add_brand"  style="position: absolute;right:0;bottom:3px;font-size:20px;line-height: 20px;"></i>
                    </a>

                    <a class="btn-floating waves-effect waves-light cyan lighten-1" style="margin-left: 20px;width:30px;height: 30px;"
                       ng-click="createCustomCar()">
                        <i class="mdi mdi-check add_brand"  style="position: absolute;right:0;bottom:3px;font-size:20px;line-height: 20px;"></i>
                    </a>
                </div>
            </div>
        </div>

        <!-- 新增运送车辆信息列表 -->
        <div class="col s12">
            <div class="col s12">
                <table class="bordered">
                    <tbody>
                    <tr ng-repeat="el in buyingCarList" class="grey-text text-darken-1">
                        <!-- VIN码 -->
                        <td>VIN码：{{el.vin}}</td>
                        <!-- 车型 -->
                        <td>{{el.make_name}}/{{el.model_name}}</td>
                        <!-- 生产日期 -->
                        <td ng-bind="el.pro_date|date:'yyyy-MM-dd'"></td>
                        <!-- 车辆估值 -->
                        <td ng-bind="el.valuation | number"></td>
                        <!-- 操作 删除 -->
                        <td class="operation right-align">
                            <i class="mdi mdi-close red-text right-align" ng-click="deleteBuyingCarRel(el.car_id)" style="cursor:pointer; right: 22px;"></i>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- TAB 4 还款记录 -->
    <div id="lookPaymentHistory" class="col s12 tab_box" style="width: 100%; margin:30px 0">

    </div>
</div>